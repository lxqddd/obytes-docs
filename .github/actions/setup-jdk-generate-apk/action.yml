# ğŸ”— é“¾æ¥ï¼š
# æºæ–‡ä»¶ï¼šhttps://github.com/obytes/react-native-template-obytes/blob/master/.github/actions/setup-jdk-generate-apk/action.yml
# å¤åˆåŠ¨ä½œæ–‡æ¡£ï¼šhttps://docs.github.com/en/actions/creating-actions/creating-a-composite-action

# âœï¸ æè¿°ï¼š
# è¿™æ˜¯ä¸€ä¸ªå¤åˆåŠ¨ä½œï¼Œæ„å‘³ç€å®ƒå¯ä»¥åœ¨å…¶ä»–åŠ¨ä½œä¸­ä½¿ç”¨ã€‚
# æ­¤åŠ¨ä½œç”¨äºè®¾ç½® JDK ç¯å¢ƒå¹¶ç”Ÿæˆç”¨äºæµ‹è¯•çš„ Android APKã€‚
# æ­¤åŠ¨ä½œæ¥å—ä¸€ä¸ªè¾“å…¥ï¼š`APP_ENV`ï¼Œç”¨äºä¸ºç‰¹å®šç¯å¢ƒç”Ÿæˆ APKï¼ˆdevelopmentã€stagingã€productionï¼‰ã€‚é»˜è®¤ä½¿ç”¨ stagingã€‚
# åœ¨ç”Ÿæˆ APK ä¹‹å‰ï¼Œæˆ‘ä»¬è¿è¡Œé¢„æ„å»ºè„šæœ¬æ¥åŸºäº APP_ENV ç”Ÿæˆå¿…è¦çš„åŸç”Ÿæ–‡ä»¶å¤¹ã€‚
# æˆåŠŸåï¼ŒAPK å°†ç”Ÿæˆåœ¨ `./android/app/build/outputs/apk/release/app-release.apk`ã€‚

# ğŸ‘€ ä½¿ç”¨ç¤ºä¾‹ï¼š
#       - name : ğŸ“¦ è®¾ç½® JDK + ç”Ÿæˆæµ‹è¯• APK
#         uses: ./.github/actions/setup-jdk-generate-apk
#         with:
#           APP_ENV: 'staging'

name: 'Setup  JDK + GRADLE + Generate APK'
description: 'Setup  JDK + GRADLE + Generate APK'
inputs:
  APP_ENV:
    description: 'APP_ENV (one of): development, staging, production'
    required: true
    default: 'staging'

runs:
  using: 'composite'
  steps:
    - name: Set Up JDK
      uses: actions/setup-java@v3
      with:
        distribution: 'zulu' # æŸ¥çœ‹ 'Supported distributions' è·å–å¯ç”¨é€‰é¡¹
        java-version: '17'
    - name: Setup Gradle
      uses: gradle/gradle-build-action@v2

    - name: Generate Test APK
      run: |
        pnpm prebuild:${{ inputs.APP_ENV }}
        cd  android
        chmod +x ./gradlew
        ./gradlew assembleRelease --no-daemon
        cd ..
      shell: bash
      env:
        EXPO_NO_DOTENV: '1'
        APP_ENV: ${{ inputs.APP_ENV }}
        CI: 'true'
