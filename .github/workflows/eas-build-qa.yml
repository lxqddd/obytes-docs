# ğŸ”— é“¾æ¥ï¼š
# æºæ–‡ä»¶ï¼šhttps://github.com/obytes/react-native-template-obytes/blob/master/.github/workflows/eas-build-qa.yml
# Starter å‘å¸ƒæµç¨‹ï¼šhttps://starter.obytes.com/ci-cd/app-releasing-process/

# âœï¸ æè¿°ï¼š
# æ­¤å·¥ä½œæµç”¨äºä¸º QA ç¯å¢ƒè§¦å‘ EAS ä¸Šçš„æ„å»ºã€‚
# å®ƒå°†åœ¨ä»“åº“ä¸Šå‘å¸ƒçš„æ¯ä¸ª GitHub å‘å¸ƒæ—¶è¿è¡Œï¼Œæˆ–å¯ä»¥ä» actions é€‰é¡¹å¡æ‰‹åŠ¨è§¦å‘ã€‚
# æ­¤å·¥ä½œæµå°†ä½¿ç”¨ ./actions/eas-build åŠ¨ä½œä»¥ staging ç¯å¢ƒè§¦å‘ EAS ä¸Šçš„æ„å»ºã€‚

# ğŸš¨ éœ€è¦ GITHUB å¯†é’¥ï¼š
#         - EXPO_TOKENï¼šç”¨äºå‘ EAS è¿›è¡Œèº«ä»½éªŒè¯çš„ Expo ä»¤ç‰Œ
#         - æ‚¨å¯ä»¥ä» https://expo.dev/settings/access-tokens è·å–å®ƒ

name: EAS QA Build (Android & IOS) (EAS)

on:
  workflow_dispatch:
  release:
    types: [published]

jobs:
  Build:
    name: EAS QA Build (Android & IOS) (EAS)
    runs-on: ubuntu-latest
    steps:
      - name: Check for EXPO_TOKEN
        run: |
          if [ -z "${{ secrets.EXPO_TOKEN }}" ]; then
            echo "You must provide an EXPO_TOKEN secret linked to this project's Expo account in this repo's secrets. Learn more: https://docs.expo.dev/eas-update/github-actions"
            exit 1
          fi
      - name: ğŸ“¦ Checkout project repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ“¦ Setup Node + PNPM + install deps
        uses: ./.github/actions/setup-node-pnpm-install

      - name: â±ï¸ EAS Build
        uses: ./.github/actions/eas-build
        with:
          APP_ENV: staging
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
          VERSION: ${{ github.event.release.tag_name }}
          IOS: false # TODO: å½“ iOS è´¦æˆ·å‡†å¤‡å°±ç»ªæ—¶è®¾ç½®ä¸º true

